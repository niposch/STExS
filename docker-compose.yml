version: '3.9'
services:
  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - backend
  backend:
    build: 
      context: ./backend
      dockerfile: ./STExS.Web/Dockerfile
    ports:
      - "5000:80"
    expose:
      - "80"
    restart: on-failure
    volumes:
      - ./backend/STExS.Web/appsettings.docker.json:/app/appsettings.json
    depends_on:
      - db
    environment:
      - DontBuildSwagger=true
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=Adminxyz123!
    ports:
      - "1433:1433"
    volumes:
      - ./sqlserver/data:/var/opt/mssql/data
      - ./sqlserver/log:/var/opt/mssql/log
      - ./sqlserver/secrets:/var/opt/mssql/secrets